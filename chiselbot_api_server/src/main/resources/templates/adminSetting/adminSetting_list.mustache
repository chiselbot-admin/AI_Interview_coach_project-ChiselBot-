{{> layout/header }}
<body id="page-top">
<div id="wrapper">
    {{> layout/sidebar }}
    <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
            {{> layout/topbar }}

            <!-- ë ˆì´ì•„ì›ƒ ì‘ì—… ë¶€ë¶„ -->
            <div class="container mt-5">
                <h2 class="mb-4 text-center fw-bold">ê´€ë¦¬ì ê³„ì • ëª©ë¡</h2>

                <div class="table-container">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="page-info">
                            ì´ {{totalElements}}ëª…ì˜ ê´€ë¦¬ì
                        </div>
                        <a href="/admin/settings/create" class="btn btn-sm btn-primary">ìƒˆ ê´€ë¦¬ì ì¶”ê°€</a>
                    </div>

                    <table class="table table-hover align-middle" id="adminTable">
                        <thead>
                        <tr>
                            <th style="width: 10%;">ID</th>
                            <th style="width: 25%;">ì´ë¦„</th>
                            <th style="width: 35%;">ì´ë©”ì¼</th>
                            <th style="width: 20%;">ë“±ë¡ì¼</th>
                            <th style="width: 10%;">ìƒì„¸</th>
                        </tr>
                        </thead>
                        <tbody>
                        {{#adminPage.content}}
                            <tr>
                                <td>{{id}}</td>
                                <td>{{adminName}}</td>
                                <td>{{email}}</td>
                                <td>{{createdAt}}</td>
                                <td>
                                    <button type="button"
                                            class="btn btn-sm btn-outline-primary btn-detail"
                                            data-id="{{id}}">
                                        ìƒì„¸ë³´ê¸°
                                    </button>
                                </td>
                            </tr>
                        {{/adminPage.content}}

                        {{^adminPage.content}}
                            <tr>
                                <td colspan="5" class="text-center text-muted">ë“±ë¡ëœ ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                            </tr>
                        {{/adminPage.content}}
                        </tbody>
                    </table>

                    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                    <nav>
                        <ul class="pagination justify-content-center">
                            {{#hasPrevious}}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{prevPage}}">ì´ì „</a>
                                </li>
                            {{/hasPrevious}}

                            {{#pageInfos}}
                                <li class="page-item {{#current}}active{{/current}}">
                                    {{#current}}
                                        <a class="page-link text-white bg-primary border-primary"
                                           tabindex="-1"
                                           style="pointer-events: none; opacity: 0.85; cursor: default;">
                                            {{number}}
                                        </a>
                                    {{/current}}
                                    {{^current}}
                                        <a class="page-link" href="?page={{index}}">{{number}}</a>
                                    {{/current}}
                                </li>
                            {{/pageInfos}}

                            {{#hasNext}}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{nextPage}}">ë‹¤ìŒ</a>
                                </li>
                            {{/hasNext}}
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        {{> layout/footer }}
    </div>
</div>

<!--ëª¨ë‹¬-->
<div class="modal fade" id="adminDetailModal" tabindex="-1" aria-labelledby="adminDetailLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="adminDetailLabel">ê´€ë¦¬ì ìƒì„¸ ì •ë³´</h5>

                <button type="button"
                        class="btn-close btn-close-white"
                        id="modalCloseBtn"
                        data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>ID:</strong> <span id="modalId"></span></p>
                <p><strong>ì´ë¦„:</strong> <span id="modalName"></span></p>
                <p><strong>ì´ë©”ì¼:</strong> <span id="modalEmail"></span></p>
                <p><strong>ë“±ë¡ì¼:</strong> <span id="modalCreatedAt"></span></p>
                <hr>
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
<!--                    <button class="btn btn-outline-danger" id="deleteBtn">ì‚­ì œ</button> DBë¬¸ì œë¡œ ë¹„í™œì„±í™”-->
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {

      function getModalInstance() {
        const el = document.getElementById('adminDetailModal');
        let modal = bootstrap.Modal.getInstance(el);
        if (!modal) {
          modal = new bootstrap.Modal(el, { backdrop: true, keyboard: true });
        }
        return modal;
      }

      async function openDetailById(id) {
        console.log("ìƒì„¸ë³´ê¸° í´ë¦­ë¨:", id);
        try {
          const res = await fetch(`/admin/settings/api/${id}`);
          if (!res.ok) throw new Error('ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨');
          const data = await res.json();

          // ë°ì´í„° í™•ì¸ ë¡œê·¸
          console.log("ìƒì„¸ë°ì´í„°:", data);

          // ë°ì´í„° ë°”ì¸ë”©
          document.getElementById("modalId").innerText = data.id ?? '';
          document.getElementById("modalName").innerText = data.adminName ?? '';
          document.getElementById("modalEmail").innerText = data.email ?? '';
          document.getElementById("modalCreatedAt").innerText = data.createdAt ?? '';

          /*const deleteBtn = document.getElementById("deleteBtn");
          deleteBtn.onclick = async function () {
            console.log("ğŸŸ¢ ì‚­ì œ ë²„íŠ¼ í´ë¦­ë¨");
            if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            try {
              const delRes = await fetch(`/admin/settings/api/${id}`, {
                method: "DELETE"
              });

              console.log("ì‚­ì œ ìš”ì²­ ì‘ë‹µ:", delRes.status);

              if (!delRes.ok) throw new Error('ì‚­ì œ ì‹¤íŒ¨');

              const modal = getModalInstance();
              modal.hide();
              alert("ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
              location.reload();
            } catch (e) {
              console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", e);
              alert(e.message || 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
          };*/

          const modal = getModalInstance();
          modal.show();

        } catch (e) {
          console.error("ìƒì„¸ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:", e);
          alert('ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
        }
      }

      document.addEventListener('click', function (e) {
        const btn = e.target.closest('.btn-detail');
        if (!btn) return;
        const id = btn.getAttribute('data-id');
        if (id) openDetailById(id);
      });

      document.getElementById('modalCloseBtn').addEventListener('click', function () {
        const modal = getModalInstance();
        modal.hide();
      });

    });
</script>



<style>
    body {
        background-color: #f8f9fa;
    }
    .table-container {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        padding: 20px;
        margin-top: 40px;
    }
    .table th {
        background-color: #f1f3f5;
    }
    .pagination {
        justify-content: center;
        margin-top: 20px;
    }
    .page-info {
        text-align: center;
        color: #6c757d;
        font-size: 0.9rem;
        margin-top: 10px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
